#  Copyright (c) 1990-1994 The Regents of the University of California.
#  Copyright (c) 1994-1996 Sun Microsystems, Inc.
#  See the file "license.terms" for information on usage and redistribution
#  of this file, and for a DISCLAIMER OF ALL WARRANTIES.
#
#

=head1 NAME

Tk::Error - Method invoked to process background errors

=for category Binding Events and Callbacks

=head1 SYNOPSIS

B<require Tk::ErrorDialog;>

I<or>

sub B<Tk::Error>

{

my (I<$mainwindow,$error,@locations>) = B<@_>;

...

}

=head1 DESCRIPTION

The B<Tk::Error> method is invoked by perl/Tk when a background
error occurs. Two possible implementations are provided in the
distribution and individual applications or users can define a B<Tk::error>
method (e.g. as a perl sub) if they wish to handle background
errors in some other manner.

A background error is one that occurs in a command that didn't
originate with the application.  For example, if an error occurs
while executing a command specified with a B<bind> of B<after>
command, then it is a background error.  For a non-background error,
the error can simply be returned up through nested Tcl command
evaluations until it reaches the top-level code in the application;
then the application can report the error in whatever way it
wishes.  When a background error occurs, the unwinding ends in
the Tk library and there is no obvious way for Tk to report
the error.

When Tk detects a background error, it saves information about the
error and invokes the B<Tk::Error> command later when Tk is idle.

B<Tk::Error> is invoked by perl/Tk as if by the perl code:

I<$mainwindow>-E<gt>B<Tk::Error>(I<"error message">,I<location ...>);

I<$mainwindow> is the B<MainWindow> associated with widget which
detected the error, I<"error message"> is a string describing the error
that has been detected, I<location> is a list of one or more "locations"
which describe the call sequence at the point the error was detected.

The locations are a typically a mixture of perl location reports giving
script name and line number, and simple strings describing locations in
core Tk or perl/Tk C code.

Tk will ignore any result returned by the B<Tk::Error> command.
If another error occurs within the B<Tk::Error> command
(for example if it calls B<die>) then Tk reports this error
itself by writing a message to stderr (this is to avoid infinite loops
due to any bugs in B<Tk::Error>).

If several background errors accumulate before B<Tk::Error>
is invoked to process them, B<Tk::Error> will be invoked once
for each error, in the order they occurred.
However, if B<Tk::Error> calls B<Tk-E<gt>break>, then
any remaining errors are skipped without calling B<Tk::Error>.

The I<Tk.pm> file includes a default (AutoLoadable) B<Tk::Error>
that simply reports the error on stderr.

An alternate definition is provided via :

B<require Tk::ErrorDialog;>

that posts a dialog box containing the error message and offers
the user a chance to see a stack trace showing where the
error occurred.

=head1 BUGS

If B<after> or B<fileevent> are not invoked as methods of a widget
then perl/Tk is unable to provide a I<$mainwindow> argument.
To support such code from earlier versions of perl/Tk
perl/Tk therefore calls B<Tk::Error> with string 'Tk' instead:
B<Tk-E<gt>Tk::Error\(...\)>.
In this case the B<Tk::Error> in B<Tk::ErrorDialog> and similar
implementations cannot "popup" a window as they don't know which display
to use. I mechanism to supply I<the> B<MainWindow> in applications
which only have one (a very common case) should be provided.

=head1 SEE ALSO

L<Tk::bind>
after
fileevent

=head1 KEYWORDS

background error, reporting
